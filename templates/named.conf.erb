// named.conf

include "<%= scope.lookupvar('::dns::rndckeypath') %>";

controls  {
<%- scope.lookupvar('::dns::controls').sort_by {|k, v| k}.each do |control_ip, control_hash| -%>
        inet <%= control_ip %> port <%= control_hash['port'] %> allow { <% control_hash['allowed_addresses'].sort.each do |address| %><%= address %>; <% end %>} keys { <% control_hash['keys'].sort.each do |key| %>"<%= key %>"; <% end %>};
<%- end -%>
};

options  {
        include "<%= scope.lookupvar('::dns::optionspath') %>";
};

<% unless [nil, :undefined, :undef, ''].include?(scope.lookupvar("::dns::localzonepath")) -%>
include "<%= scope.lookupvar('::dns::localzonepath') %>";
<% end -%>

<%- scope.lookupvar('::dns::acls').sort_by {|k, v| k}.each do |acl_name, acl_array| -%>
acl "<%= acl_name %>"  {
        <%- acl_array.sort.each do |subnet| -%>
        <%= subnet %>;
        <%- end -%>
};
<%- end -%>

<%- scope.lookupvar('::dns::additional_files').each do |includefile| -%>
include "<%= includefile %>";
<%- end -%>

<%- scope.lookupvar('::dns::additional_config').sort_by {|k, v| k}.each do |option, value| -%>
<%= option %> <%= value %>;
<%- end -%>

// Public view read by Server Admin
include "<%= scope.lookupvar('::dns::publicviewpath') %>";
